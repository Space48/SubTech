<!-- Sub2Tech Basket Tracking -->
<script>
    /**
     * Copyright Â© 2016 Magento. All rights reserved.
     * See COPYING.txt for license details.
     */

    var basketXmlCookieName = '<?= /* @NoEscape */ \Space48\SubTech\Observer\SalesQuoteSaveAfterObserver::BASKET_XML_COOKIE_NAME ?>';

    require([
        "jquery",
        "prototype",
        "Magento_Customer/js/customer-data"
    ], function(jQuery, prototype, customerData){

        console.log("into basket.phtml");

        function getCookie(name) {
            var cookie = " " + document.cookie;
            var search = " " + name + "=";
            var setStr = null;
            var offset = 0;
            var end = 0;
            if (cookie.length > 0) {
                offset = cookie.indexOf(search);
                if (offset != -1) {
                    offset += search.length;
                    end = cookie.indexOf(";", offset);
                    if (end == -1) {
                        end = cookie.length;
                    }
                    setStr = decodeURI(cookie.substring(offset, end));
                }
            }
            return(setStr);
        }

        function delCookie(name) {
            var date = new Date(0);
            var cookie = name + "=" + "; path=/; expires=" + date.toUTCString();
            document.cookie = cookie;
        }

        document.observe('dom:loaded', function() {

            var basketXml = decodeURI(getCookie(basketXmlCookieName));

            __s2tQ.push(['sendBasket' , basketXml]);
            console.log("Sent basket data to Sub2");
            console.log(basketXml);
            delCookie("subscriberEmail");
        });

    });

</script>
<!-- Sub2Tech Basket Tracking -->

